<!doctype html>
<html lang="es" class="dark:scrollbar dark:scrollbar-thumb-gray-600 dark:scrollbar-track-gray-900">
	<head>
		<script id="env">
			// Pasamos variables de entorno al cliente
			globalThis.window.__env = {
				BACK_BASE: 'https://localhost:8080',
				BACK_STREAM: 'https://localhost:8090',
				BACK_CHAT: 'https://localhost:8070',
				BACK_CHAT_WSS: 'wss://localhost:8070',
				BACK_STREAM_WSS: 'wss://localhost:8090',
			};
		</script>

		<script type="module">
			// Intenta obtener el token de inicio del backend
			const BACK_BASE = globalThis.window.__env?.BACK_BASE || 'https://localhost:8080';
			try {
				await fetch(BACK_BASE + '/init/auth', {
					credentials: 'include',
					headers: {
						'Authorization': 'Basic ' + btoa('Visitante:visitante'),
					},
				});
			} catch (err) {
				console.error('[Preload] No se pudo obtener la cookie initToken del backend:', err);
			}
		</script>

		<script>
			// Detecta el tema del sistema y aplica la clase dark si es necesario
			if (localStorage.theme === 'dark' || (!('theme' in localStorage) && globalThis.window.matchMedia('(prefers-color-scheme: dark)').matches)) {
				document.documentElement.classList.add('dark');
			} else {
				document.documentElement.classList.remove('dark');
			}
		</script>
		<script>
			// Para tener window de forma global
			var global = globalThis.window;
		</script>
		<meta charset="utf-8" />
		<title>Sovereign School</title>
		<base href="/" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<meta
			name="description"
			content="El mejor lugar para aprender Soberanía!!! Los mayores expertos en Soberanía, Ley Natural, Derecho Consuetudinario, Derecho Marítimo y Derecho Canónico,
		Juntos en una sola plataforma, ofreciendo sus conocimientos a todo Hombre/Mujer interesados en la libertad."
		/>
		<meta name="keywords" content="Sovereign School, Soberanía, Ley Natural, Derecho Consuetudinario, Derecho Marítimo, Derecho Canónico" />
		<meta name="author" content="Giacca90" />
		<meta name="robots" content="index, follow" />
		<link rel="icon" type="image/x-icon" href="favicon.ico" />
	</head>
	<body>
		<app-root class="dark:scrollbar dark:scrollbar-thumb-gray-600 dark:scrollbar-track-gray-900"></app-root>
		<script>
			// Registro de visitas
			fetch('https://giacca90.ddns.net:5011/log', {
				method: 'POST',
				headers: { 'Content-Type': 'application/json' },
				body: JSON.stringify({
					project: 'SovSchool', // Identifica tu proyecto
					url: globalThis.window.location.href,
					referrer: document.referrer,
				}),
			}).catch((err) => console.error('No se pudo registrar visita:', err));
		</script>
	</body>
</html>
